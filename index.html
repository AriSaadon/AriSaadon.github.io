<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Squares</title>
    <style>
        body {
            overflow: hidden;
            margin: 0;
            height: 100vh;
        }

        .square {
            position: absolute;
            left: 50%;
            transform: translate(-50%, 0);
        }

        #squareA {
            background-color: blue;
        }

        #squareB {
            background-color: red;
        }

        #squareC {
            background-color: orange;
        }

        #squareD {
            background-color: green;
        }
    </style>
</head>

<body>
    <div id="squareA" class="square"></div>
    <div id="squareB" class="square"></div>
    <div id="squareC" class="square"></div>
    <div id="squareD" class="square"></div>
    <script>
        class Square {
            constructor(elementId, targetProgress, keyframes) {
                this.element = document.getElementById(elementId);
                this.keyframes = keyframes;
                this.targetProgress = targetProgress;
                this.addClickListener();
            }

            addClickListener() {
                this.element.addEventListener('click', () => {
                    targetProgress = this.targetProgress;
                });
            }

            adjust(scrollProgress) {
                const lowerKeyframe = this.keyframes.slice().reverse().find(k => k.progress <= scrollProgress) || this.keyframes[0];
                const upperKeyframe = this.keyframes.find(k => k.progress >= scrollProgress) || lowerKeyframe;

                const range = upperKeyframe.progress - lowerKeyframe.progress;
                const localProgress = range !== 0 ? (scrollProgress - lowerKeyframe.progress) / range : 0;

                const width = Math.min(window.innerWidth, 1000) * this.lerp(lowerKeyframe.width, upperKeyframe.width, localProgress);
                const height = window.innerHeight * this.lerp(lowerKeyframe.height, upperKeyframe.height, localProgress);
                const x = window.innerWidth * this.lerp(lowerKeyframe.x, upperKeyframe.x, localProgress);
                const y = window.innerHeight * this.lerp(lowerKeyframe.y, upperKeyframe.y, localProgress);
                const backgroundColor = this.lerpColor(lowerKeyframe.backgroundColor, upperKeyframe.backgroundColor, localProgress);

                this.element.style.width = `${width}px`;
                this.element.style.height = `${height}px`;
                this.element.style.left = `${x}px`;
                this.element.style.top = `${y}px`;
                this.element.style.borderRadius = `${this.lerp(lowerKeyframe.border, upperKeyframe.border, localProgress)}px`;
                this.element.style.backgroundColor = backgroundColor;
            }

            lerp(start, end, t) {
                t = t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
                return start + (end - start) * t;
            }

            lerpColor(start, end, t) {
                const startRGB = this.hexToRgb(start);
                const endRGB = this.hexToRgb(end);
                const r = Math.round(this.lerp(startRGB.r, endRGB.r, t));
                const g = Math.round(this.lerp(startRGB.g, endRGB.g, t));
                const b = Math.round(this.lerp(startRGB.b, endRGB.b, t));
                return `rgb(${r}, ${g}, ${b})`;
            }

            hexToRgb(hex) {
                const bigint = parseInt(hex.slice(1), 16);
                const r = (bigint >> 16) & 255;
                const g = (bigint >> 8) & 255;
                const b = bigint & 255;
                return { r, g, b };
            }
        }

        const squares = [
            new Square('squareA', 0.0, [
                { progress: 0.0, x: 0.5, y: 0.00, width: 1, height: 0.85, border: 0, backgroundColor: '#0000FF' },
                { progress: 0.2, x: 0.5, y: 0.01, width: 0.97, height: 0.1, border: 20, backgroundColor: '#FF0000' },
                { progress: 0.8, x: 0.5, y: 0.01, width: 0.97, height: 0.1, border: 20, backgroundColor: '#00FF00' },
                { progress: 1.0, x: 0.5, y: 0.00, width: 1, height: 0.85, border: 0, backgroundColor: '#0000FF' },
            ]),
            new Square('squareB', 0.2, [
                { progress: 0.0, x: 0.5, y: 0.85, width: 1, height: 0.05, border: 0, backgroundColor: '#FF0000' },
                { progress: 0.2, x: 0.5, y: 0.12, width: 1, height: 0.78, border: 0, backgroundColor: '#00FF00' },
                { progress: 0.4, x: 0.5, y: 0.12, width: 0.97, height: 0.1, border: 20, backgroundColor: '#0000FF' },
                { progress: 0.8, x: 0.5, y: 0.12, width: 0.97, height: 0.1, border: 20, backgroundColor: '#00FFFF' },
                { progress: 1.0, x: 0.5, y: 0.85, width: 1, height: 0.05, border: 0, backgroundColor: '#FF0000' },
            ]),
            new Square('squareC', 0.4, [
                { progress: 0.2, x: 0.5, y: 0.90, width: 1, height: 0.05, border: 0, backgroundColor: '#FFA500' },
                { progress: 0.4, x: 0.5, y: 0.23, width: 1, height: 0.72, border: 0, backgroundColor: '#00FF00' },
                { progress: 0.6, x: 0.5, y: 0.23, width: 0.97, height: 0.1, border: 20, backgroundColor: '#FF0000' },
                { progress: 0.8, x: 0.5, y: 0.23, width: 0.97, height: 0.1, border: 20, backgroundColor: '#00FFFF' },
                { progress: 1.0, x: 0.5, y: 0.90, width: 1, height: 0.05, border: 0, backgroundColor: '#FFA500' },
            ]),
            new Square('squareD', 0.6, [
                { progress: 0.4, x: 0.5, y: 0.95, width: 1, height: 0.06, border: 0, backgroundColor: '#008000' },
                { progress: 0.6, x: 0.5, y: 0.34, width: 1, height: 0.66, border: 0, backgroundColor: '#0000FF' },
                { progress: 0.8, x: 0.5, y: 0.34, width: 0.97, height: 0.1, border: 20, backgroundColor: '#FF0000' },
                { progress: 1.0, x: 0.5, y: 0.95, width: 1, height: 0.05, border: 0, backgroundColor: '#008000' },
            ])
        ];

        let scrollProgress = 0.0;
        let targetProgress = 0.0;

        function animate() {
            let delta = targetProgress - scrollProgress;

            if (delta > 0.5) delta -= 1;
            if (delta < -0.5) delta += 1;

            scrollProgress += delta * 0.05;
            scrollProgress = (scrollProgress % 1 + 1) % 1;

            squares.forEach(square => square.adjust(scrollProgress));
            requestAnimationFrame(animate);
        }

        document.addEventListener('wheel', function (event) {
            targetProgress += event.deltaY * 0.00015;
            targetProgress = (targetProgress % 1 + 1) % 1;
        }, { passive: false });

        let touchStartY = 0;

        document.addEventListener('touchstart', function (event) {
            touchStartY = event.touches[0].clientY;
        }, { passive: false });

        document.addEventListener('touchmove', function (event) {
            const touchEndY = event.touches[0].clientY;
            const deltaY = touchStartY - touchEndY;
            targetProgress += deltaY * 0.00075; // Adjust the multiplier as needed for sensitivity
            targetProgress = (targetProgress % 1 + 1) % 1;
            touchStartY = touchEndY;

            event.preventDefault();  // Prevent the default pull-to-refresh behavior

        }, { passive: false });

        animate();

    </script>
</body>

</html>
